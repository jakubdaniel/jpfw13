\ProvidesPackage{beamerthemeD3S}[2013/09/24]

\mode<all>

\def\beamer@D3S@true{true}
\def\beamer@D3S@false{false}

\DeclareOptionBeamer{footlineauthor}{\def\beamer@D3S@footlineauthor{1}}
\def\beamer@D3S@footlineauthor{0}
\ProcessOptionsBeamer

\beamertemplatenavigationsymbolsempty

\usepackage[english]{babel}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{shadowtext}
\usepackage{forloop}  
\usepackage[trim]{tokenizer}  
\usepackage[iso,yyyymmdd]{datetime}
\usepackage{listings}

\lstset{%
  language=Java,%
  tabsize=8,%
  keepspaces,%
  extendedchars=true,%
  basicstyle=\footnotesize,%
  aboveskip=5pt,%
  upquote=true,%
  columns=fixed,%
  showstringspaces=false,%
  extendedchars=true,%
  breaklines=true,%
  showtabs=true,%
  showspaces=false,%
  showstringspaces=false,%
  escapechar=`,%
}

\newcounter{rrCount}  
\newcommand{\replace}[3]{% 
  \GetTokens{rrFirst}{rrRest}{#3#1}%
  \rrFirst%
  \forloop{rrCount}{0}{\value{rrCount} < 100}{%
    \ifthenelse{\equal{\rrRest}{}}{%
      \setcounter{rrCount}{101}%
    }{% 
      \GetTokens{rrFirst}{rrRest}{\rrRest}%
      #2\rrFirst%
    }%  
  }%  
}

\setbeamercolor{frametitle}{fg=black}
\setbeamercolor{block title}{fg=black}
\setbeamercolor{title}{fg=black}
\setbeamercolor{titlelike}{fg=black}

\setbeamertemplate{itemize item}{\includegraphics[width=1ex,keepaspectratio]{Item}}
\setbeamertemplate{itemize subitem}{\includegraphics[width=1ex,keepaspectratio]{SubItem}}
\setbeamertemplate{itemize subsubitem}{\includegraphics[width=1ex,keepaspectratio]{SubSubItem}}

\def\titleframe{%
  \addtocounter{framenumber}{-1}%
  {%
    \setbeamertemplate{headline}{}%
    \setbeamertemplate{frametitle}{}%
    \setbeamertemplate{footline}{}%
    \setbeamertemplate{background canvas}[vertical shading][top=white,bottom=gray!25]%
    \frame{\titlepage}%
  }%
}

\setbeamertemplate{background canvas}{%
  \vbox to \dimexpr\paperheight - 1em\relax {%
    \vfill%
    \hbox to \paperwidth {\hfill \includegraphics[scale=0.15]{D3SWM}}%
  }%
}

\setbeamertemplate{title page}{%
  \vbox to 1.5cm {%
    \shadowoffset{0.75pt}\shadowtext{\parbox{\textwidth}{\centering \bf \fontsize{24}{24}\selectfont \inserttitle}}%
  }%
  \colorbox{gray}{%
    \makebox[\textwidth][l]{%
      \bf \fontsize{6}{6}\selectfont \color{white} http://d3s.mff.cuni.cz%
    }%
  }%
  \vspace{0.25cm}%
  \begin{columns}[b]%
    \begin{column}[T]{\dimexpr 0.5\textwidth - 0.75cm\relax}%
      \includegraphics[width=4cm,keepaspectratio]{D3S} \\%
      \vspace{0.5cm}%
      \hspace{1cm} \includegraphics[width=2cm,keepaspectratio]{CUNI} \\%
      \makebox[4cm][c]{\bf \fontfamily{ppl}\fontsize{6}{6}\selectfont \color{gray} CHARLES UNIVERSITY IN PRAGUE} \\%
      \colorbox{gray}{\makebox[4cm][c]{\bf \fontfamily{ppl}\fontsize{6}{6}\selectfont \color{white} faculty of mathematics and physics}} \\%
    \end{column}%
    \begin{column}[T]{\dimexpr 0.5\textwidth - 0.75cm\relax}%
      \raggedleft \it%
      \replace{, }{\\}{\insertauthor}%
    \end{column}%
  \end{columns}%
}

\setbeamertemplate{frametitle}{%
  \vspace{-1cm}%
  \fontsize{16}{16}\selectfont%
  \shadowoffset{0.75pt}%
  \shadowtext{\insertframetitle}%
}

\setbeamertemplate{headline}{%
  \vspace{1cm}%
  \includegraphics[width=\paperwidth]{Head}%
}

\setbeamertemplate{footline}{%
  {%
    \colorbox{gray!50}{%
      \makebox[\paperwidth][c]{%
        \hspace{1em}%
        \if\beamer@D3S@footlineauthor1%
          {\bf \fontsize{4}{4}\selectfont \insertauthor, }%
        \fi%
        {\fontsize{4}{4}\selectfont D3S Seminar, \today}%
        \hfill%
        {\bf \fontsize{4}{4}\selectfont \inserttitle}%
        \hfill%
        {\bf \fontsize{4}{4}\selectfont \insertframenumber}%
        \hspace{1em}%
      }%
    }%
  }%
}
